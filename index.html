<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>帰参届 申込システム</title>
    <style>
        :root { --main-red: #e74c3c; --line-green: #06C755; }
        body { font-family: sans-serif; background: #f4f7f6; padding: 15px; margin: 0; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; font-size: 2.5rem; margin-bottom: 10px; color: #333; }
        h2 { font-size: 1.2rem; border-left: 5px solid #2c3e50; padding-left: 10px; margin-top: 20px; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        .num-group { display: flex; gap: 5px; }
        .num-group div { flex: 1; }
        .red-box { border: 2px solid var(--main-red); padding: 15px; border-radius: 8px; margin-top: 20px; }
        .red-box h3 { color: var(--main-red); margin: 0 0 10px 0; font-size: 1.1rem; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .btn-confirm { background: #34495e; color: white; }
        .btn-line { background: var(--line-green); color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table, th, td { border: 1px solid #ccc; padding: 8px; text-align: center; font-size: 0.9rem; }
        th { background: #eee; }
        #confirmPage { display: none; }
    </style>
</head>
<body>

<div id="inputPage" class="container">
    <h1>帰参届</h1>
    
    <label>教会名（団体名）</label>
    <input type="text" id="church" placeholder="例：〇〇分教会">

    <label>帰参者名（代表）</label>
    <input type="text" id="repName">

    <label>連絡先</label>
    <input type="tel" id="tel" placeholder="090-0000-0000">

    <label>人数（大人・子供・乳児）</label>
    <div class="num-group">
        <div><small>大人</small><input type="number" id="pAdult" value="0"></div>
        <div><small>子供</small><input type="number" id="pChild" value="0"></div>
        <div><small>乳児</small><input type="number" id="pBaby" value="0"></div>
    </div>

    <label>到着・出発日時</label>
    <input type="datetime-local" id="arrival" onchange="generateMealTable()">
    <input type="datetime-local" id="departure" onchange="generateMealTable()">

    <label>交通手段</label>
    <select id="transport">
        <option value="公共交通（電車・バス）">公共交通（電車・バス）</option>
        <option value="観光バス">観光バス</option>
        <option value="マイクロバス">マイクロバス</option>
        <option value="自家用車">自家用車</option>
    </select>
    <input type="text" id="carNum" placeholder="台数など詳細">

    <div id="mealArea">
        <h2>宿泊・食事計画</h2>
        <div id="dateList">到着・出発日を入力すると表示されます</div>
    </div>

    <div class="red-box">
        <h3>直属食券申込（赤色）</h3>
        <p style="font-size: 0.75rem; color: var(--main-red);">※直属食券が発行される日、申込〆切日をよくご確認ください。</p>
        <label>日付・食数</label>
        <input type="text" id="specialTicket" placeholder="例：25日 昼3枚">
    </div>

    <label>備考</label>
    <textarea id="memo" rows="3"></textarea>

    <button class="btn btn-confirm" onclick="showConfirm()">確認ページへ</button>
</div>

<div id="confirmPage" class="container">
    <h1>内容確認</h1>
    <div id="summaryTable"></div>
    <button class="btn btn-line" onclick="sendLine()">この内容をLINEで送る</button>
    <button class="btn" onclick="location.reload()" style="background:#ccc;">修正する</button>
</div>

<script>
    function generateMealTable() {
        const start = new Date(document.getElementById('arrival').value);
        const end = new Date(document.getElementById('departure').value);
        const list = document.getElementById('dateList');
        if (isNaN(start) || isNaN(end)) return;

        let html = '<table><tr><th>日付</th><th>朝</th><th>昼</th><th>夕</th><th>泊</th></tr>';
        let current = new Date(start);
        while (current <= end) {
            const dateStr = (current.getMonth()+1) + '/' + current.getDate();
            html += `<tr>
                <td>${dateStr}</td>
                <td><input type="checkbox" class="m-check" data-date="${dateStr}" data-type="朝"></td>
                <td><input type="checkbox" class="m-check" data-date="${dateStr}" data-type="昼"></td>
                <td><input type="checkbox" class="m-check" data-date="${dateStr}" data-type="夕"></td>
                <td><input type="checkbox" class="m-check" data-date="${dateStr}" data-type="泊"></td>
            </tr>`;
            current.setDate(current.getDate() + 1);
        }
        html += '</table>';
        list.innerHTML = html;
    }

    function showConfirm() {
        const data = {
            church: document.getElementById('church').value,
            name: document.getElementById('repName').value,
            tel: document.getElementById('tel').value,
            p: `大人${document.getElementById('pAdult').value}名/子${document.getElementById('pChild').value}名/乳${document.getElementById('pBaby').value}名`,
            stay: `${document.getElementById('arrival').value} ～ ${document.getElementById('departure').value}`,
            trans: `${document.getElementById('transport').value} (${document.getElementById('carNum').value})`,
            ticket: document.getElementById('specialTicket').value,
            memo: document.getElementById('memo').value
        };

        let mealDetails = "";
        document.querySelectorAll('.m-check:checked').forEach(el => {
            mealDetails += `[${el.dataset.date}${el.dataset.type}] `;
        });

        document.getElementById('summaryTable').innerHTML = `
            <table style="text-align:left;">
                <tr><th>団体</th><td>${data.church}</td></tr>
                <tr><th>氏名</th><td>${data.name}</td></tr>
                <tr><th>人数</th><td>${data.p}</td></tr>
                <tr><th>期間</th><td>${data.stay}</td></tr>
                <tr><th>交通</th><td>${data.trans}</td></tr>
                <tr><th>食事宿泊</th><td>${mealDetails}</td></tr>
                <tr style="color:red;"><th>直属食券</th><td>${data.ticket}</td></tr>
                <tr><th>備考</th><td>${data.memo}</td></tr>
            </table>`;
        
        document.getElementById('inputPage').style.display = 'none';
        document.getElementById('confirmPage').style.display = 'block';
        window.tempData = data;
        window.tempMeals = mealDetails;
    }

    function sendLine() {
        const d = window.tempData;
        const text = `【帰参届】\n■団体:${d.church}\n■氏名:${d.name}\n■連絡:${d.tel}\n■人数:${d.p}\n■期間:${d.stay}\n■交通:${d.trans}\n■食事:${window.tempMeals}\n■直属食券:${d.ticket}\n■備考:${d.memo}`;
        const lineUrl = `https://line.me/R/share?text=${encodeURIComponent(text)}`;
        window.location.href = lineUrl;
    }
</script>

</body>
</html>
